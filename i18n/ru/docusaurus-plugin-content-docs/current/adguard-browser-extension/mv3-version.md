---
title: Браузерное расширение AdGuard MV3 для Chrome
sidebar_position: 5
---

Поскольку интернет-магазин Chrome скоро совсем перестанет поддерживать MV2-расширения, пользователям рекомендуется перейти на MV3-расширения, совместимые с новым API Chrome Manifest V3. Что мы думаем о новом API Chrome, мы не раз рассказывали [в блоге](https://adguard.com/ru/blog/tag/manifest-v3.html).

Наше MV3-расширение эффективно блокирует рекламу и трекеры, а также убирает виджеты социальных сетей, баннеры и видеорекламу. Большинство пользователей не заметят переход на MV3, но о некоторых ограничениях и изменениях следует рассказать.

## Где найти наши расширения

**MV3-расширение** заменило наше старое расширение [в интернет-магазине Chrome](https://chromewebstore.google.com/detail/adguard-adblocker/bgnkhhnnamicmpeenaelnjfhikgbkllg).

**Бета-версия MV3** по-прежнему доступна [в интернет-магазине Chrome](https://chromewebstore.google.com/detail/adguard-adblocker-mv3-exp/apjcbfpjihpedihablmalmbbhjpklbdf).

Бета-версия старого расширения будет переименована в [**AdGuard Антибаннер**](https://chromewebstore.google.com/detail/adguard-adblocker-beta/gfggjaccafhcbfogfkogggoepomehbjl) и будет поддерживаться до тех пор, пока Google это позволяет.

## Основные изменения в функциях и настройках

- **Нет автоматического и ручного обновления фильтров.** Во вкладке _Фильтры_ больше нет опций _Автообновление фильтров_ и _Проверить обновления фильтров_. Поскольку некоторые правила теперь применяются с помощью DNR, мы не можем обновлять фильтры по запросу, только через полное обновление расширения в сторах.

- **Журнал фильтрации**

    ![Журнал фильтрации \*border](https://cdn.adtidy.org/content/blog/mv3/new/log.png)

    Из-за ограничений declarativenetRequest мы не можем точно показать, какое правило сработало, но покажем «предполагаемое правило» на основе данных нашего движка. Для получения точной информации можно самостоятельно установить «распакованное» расширение в браузере. Как это сделать, вы узнаете [в другой статье](/adguard-browser-extension/solving-problems/debug-rules/).

- _Защита от трекинга_

    ![Защита от трекинга \*border](https://cdn.adtidy.org/content/blog/mv3/new/tracking_screen.png)

    Здесь больше нет раздела _Файлы cookie_, а также _Самоуничтожение куки сайта_ и _Самоуничтожение сторонних куки_ отсутствуют, поскольку мы не можем устанавливать время жизни файлов cookie с помощью декларативных правил.

- В основных настройках больше нет вкладки _Защита от фишинговых и вредоносных сайтов_. Чтобы защитить себя от таких сайтов, включите соответствующие фильтры _Безопасности_ на вкладке _Фильтры_.

    ![Безопасность \*border](https://cdn.adtidy.org/content/blog/mv3/new/security.png)

## Ограничения

### Максимальное количество правил и фильтров

Manifest V3 накладывает ограничения на статические правила и правила с регулярными выражениями для каждого расширения. Пользователи могут увидеть уведомления, если эти ограничения превышены.

![Лимиты правил \*border](https://cdn.adtidy.org/content/blog/new/rulelimits.png)

![Слишком много расширений \*border](https://cdn.adtidy.org/content/blog/new/other_extension.png)

Manifest V3 делит правила на статические (встроенные) и динамические, и для всех действуют строгие ограничения.

**Статические правила:** минимум **30 000** правил на расширение, с общим лимитом **330 000** для всех расширений, установленных одним пользователем.

Для правил с регулярными выражениями лимит составит **1000 правил на расширение**.

Максимальное количество одновременно включенных фильтров — **50**.

**Динамические правила:** установлено строгое ограничение в **5000** правил, включая не более 1000 правил с регулярными выражениями.

Если этот лимит превышен, будут применены только **5000 преобразованных правил** в следующем порядке: правила Белого списка, Пользовательские правила и Собственные фильтры.

> **Преобразованные правила** — это правила, которые были преобразованы
> в \[формат DNR] с помощью [декларативного конвертера][github-declarative-converter].
> В ходе преобразования некоторые правила могут отменять другие (`$badfilter`), а некоторые могут объединиться (`$removeparam`), в результате чего порядок правил изменится.
>
> Из этого списка преобразованных правил будут использоваться только 5000 правил. Остальные будут отображены в редакторе, но применяться не будут.

Вот пример того, как правило с базовым модификатором преобразуется в декларативное правило:

```adblock
||example.org^$script,third-party,domain=example.com
```

преобразуется в

```json
[
    {
        "id": 1,
        "action": {
            "type": "block"
        },
        "condition": {
            "urlFilter": "||example.org^",
            "domainType": "thirdParty",
            "initiatorDomains": [
                "example.com"
            ],
            "resourceTypes": [
                "script"
            ]
        },
        "priority": 302
    }
]
```

Больше примеров можно найти [на GitHub][github-declarative-converter-examples].

### Модификаторы сетевых правил

Применение модификаторов сетевых правил тоже изменилось: некоторые вообще не могут быть реализованы в условиях MV3, а некоторые работают с ограничениями.

Более подробную информацию об ограничениях можно найти [на GitHub][github-declarative-converter].
Добавили информацию об этих модификаторах [в Базу знаний](/general/ad-filtering/create-own-filters).

[DNR format]: https://developer.chrome.com/docs/extensions/reference/api/declarativeNetRequest#build-rules
[github-declarative-converter]: https://github.com/AdguardTeam/tsurlfilter/tree/master/packages/tsurlfilter/src/rules/declarative-converter#table-of-contents
[github-declarative-converter-examples]: https://github.com/AdguardTeam/tsurlfilter/tree/master/packages/tsurlfilter/src/rules/declarative-converter#basic-examples
