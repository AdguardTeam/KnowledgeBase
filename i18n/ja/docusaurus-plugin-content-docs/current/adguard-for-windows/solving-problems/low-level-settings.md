---
title: 詳細設定（旧「ローレベル設定」）ガイド
sidebar_position: 7
---

:::info

この記事では、システムレベルでお使いのデバイスを保護する多機能広告ブロッカー、「AdGuard for Windows」について書いています。 実際にどのように動作するかを確認するには、[AdGuard アプリをダウンロード](https://agrd.io/download-kb-adblock)してください。

:::

（以前は旧名「ローレベル設定」として知られていた）詳細設定には、ほとんどの場合、一般ユーザーの知識を超え、日常的な使用では必要ないオプションが含まれています。 AdGuard for Windows は、これらの機能を変更することなく動作するように設計されていますが、一部のコーナーケースや一般的でない問題を解決する際に役立つ追加機能が詳細設定にあります。

:::caution

*詳細設定*を考えずに変更することは AdGuard のパフォーマンスの悪化やインターネット接続の切断、もしくはあなたのセキュリティやプライバシーを侵害してしまう可能性があります。 このセクションで何かを変更するのは、あなたが何をしているのか自信がある場合、またはサポートチームから依頼された場合のみとすることをお勧めします。

:::

## 詳細設定にアクセスする方法

*詳細設定*に移動するには、メインウィンドウで⚙️*「設定」→「一般設定」を*クリックし、「*詳細設定*」までスクロールダウンします。 または、トレイメニューで*「詳細設定」→「詳細設定...」* を選択します。

## 詳細設定

詳細設定を開くと、以下のオプションが表示されます:

### TCP Fast Openをブロックする

有効にすると、AdGuardはEdgeブラウザのTCP Fast Openをブロックします。 この設定の変更を適用するには、ブラウザを再起動する必要があります。

### Encrypted Client Hello を使用する

暗号化されたインターネット接続には、暗号化されていない部分があります。 その部分とは、接続先のサーバー名を含む最初の通信パケットです。 Encrypted Client Hello 技術は、この問題を解決し、この暗号化されていない部分を暗号化してくれます。 この機能を利用するには、「*Encrypted Client Hello を使用する*」オプションを有効にします。 このオプションは、ローカル DNS プロキシを使用して、ドメインの ECH 構成を検索します。 見つかった場合、ClientHello パケットは暗号化されます。

### Webサイトの証明書の透明性を確認する

Chrome Certificate Transparency Policy（証明書透過性ポリシー）に基づき、ドメインのすべての証明書の信頼性を検証します。 証明書が Chrome Certificate Transparency Policy（Chrome 証明書の透明性に関するポリシー）に準拠していない場合、AdGuard は Web サイトをフィルタリングしません。 そして Chrome はそれをブロックします。

### SSL/TLS証明書の失効チェックを有効にする

このオプションを有効にすると、非同期OCSPチェックが実行され、ウェブサイトのSSL/TLS証明書が失効しているかどうかがチェックされます。

OCSP チェックが最小タイムアウト内に完了すると、AdGuard は結果を直ちに適用します（証明書が取り消されている場合は接続をブロックし、証明書が有効な場合は接続を確立します）。

検証に時間がかかりすぎる場合、AdGuardは接続を確立し、バックグラウンドでチェックを続けます。 証明書が失効している場合は、そのドメインへの現在の接続および今後の接続はブロックされるようになります。

### 設定で「AdGuard VPN」項目を表示する

このオプションを有効にすると、[設定] に [AdGuard VPN] タブが表示され、そのアプリやホームページを簡単に開くことができます。

### フルパスを入力してアプリをフィルタリングから除外する

AdGuardが特定のアプリをフィルタリングしないようにしたい場合は、そのアプリへのフルパスを指定すると、そのアプリはフィルタリングから除外されます。 異なるパスはセミコロンで区切ります。

### AdGuardのポップアップ通知を有効にする

この機能を有効にすると、AdGuardのポップアップ通知が表示されるようになります。 あまり頻繁には表示されず、重要な情報のみが含まれます。 トレイ メニューを使用して、最後のポップアップ通知を呼び出すこともできます。

### フィルタ・サブスクリプションURLを自動的に傍受する

AdGuard に購読 URL (例: `abp:subscribe` など) を自動的に傍受させ、カスタムフィルタインストールウィンドウを開くようにさせたい場合は、この機能を有効にします。

### HTTP/3 をフィルタリングする

このオプションを有効にすると、AdGuard は、他のリクエストタイプに加えて、HTTP/3 で送信されたリクエストもフィルタリングします。

### リダイレクト・ドライバ・モードを使用する

このオプションを有効にすると、AdGuard はすべてのトラフィックを傍受し、さらにフィルタリングするためにローカルプロキシサーバーにリダイレクトします。

それ以外の場合、AdGuard はリダイレクトせずにすべてのトラフィックを即座にフィルタリングします。 この場合、システムは AdGuard をインターネットに接続する唯一のアプリと見なします (他のアプリケーションは AdGuard を経由してルーティングされます)。 欠点として、システムのファイアウォールの効果が低下することがあります。 利点は、このアプローチの方が少し速く動作することです。

### システム起動時にメインウィンドウを開く

このオプションを有効にすると、システムの起動後に AdGuard のメインウィンドウが開きます。 実際のフィルタリングサービスが起動するかどうかには影響しないことにご注意ください。その設定は*「設定」→「一般設定*」にあります。

### システム起動時にフィルタリングを有効にする

v7.12以降、デフォルトでは、[システム起動時にAdGuardを起動]オプションが無効になっている場合、AdGuardのサービスはOS起動後にトラフィックをフィルタリングしません。 つまり、AdGuard のサービスは「アイドル」モードで開始されます。 このオプションを有効にすると、アプリが起動されていない場合でも AdGuard がトラフィックをフィルタリングします。

:::note

v7.12 以前では、AdGuard サービスはデフォルトでフィルタリングモードで開始されていました ( *システム起動時に AdGuard を起動* が無効になっている場合でも)。 以前の動作に満足していた場合は、このオプションを有効にしてください。

:::

### localhostをフィルタリングする

AdGuard がループバック接続をフィルタリングするようにしたい場合は、チェックボックスをオンにします。 AdGuard VPN がインストールされている場合はこのオプションが常にオンになります。インストールされいない場合は機能しないからです。

### 指定のIP範囲をフィルタリングから除外する

AdGuardに特定のサブネットをフィルタリングさせたくない場合は、この機能を有効にし、下の「**フィルタリングから除外するIP範囲**」セクションで、CIDR表記（例：98.51.100.14/24）でIP範囲を指定します。

### HAR writing を有効にする

このオプションは、**デバッグ目的でのみ**有効にしてください。 チェックボックスをオンにすると、AdGuard は、フィルタされたすべての HTTP リクエストに関する情報を含む HAR 1.2 形式のファイルを作成します。 このファイルは Fiddler アプリで分析できます。 ※このオプションがオンの時は、ウェブブラウジングの速度が著しく低下する可能性がありますのでご注意ください。

### プレーンHTTPリクエストに余分なスペースを追加する

HTTPメソッドとURLの間に余分なスペースを追加し、「Host: 」欄の後のスペースを削除します。そうすることでdeep packet inspection（DPI）を回避します。 例えば、以下のリクエスト

`GET /foo/bar/ HTTP/1.1
Host: example.org`

は、以下に変換されます:

`GET /foo/bar/ HTTP/1.1
Host: example.org`

このオプションは、「*DPIから保護する*」というステルスモード機能が有効になっている場合にのみ適用されます。

### 最初のTLSパケットのフラグメントサイズを調整する

このオプションは、TCPパケットの断片化のサイズを指定し、ディープ・パケット・インスペクション（DPI）を回避するのに役立ちます。 このオプションは、保護された（HTTPS）トラフィックにのみ影響します。

このオプションを有効にすると、AdGuardは最初のTLSパケット(ClientHelloパケット)を2つの部分に分割います。最初の部分は指定された長さで、2番目の部分は最初のTLSパケット全体の長さまでの残りの内容です。

有効な値は 1～1500 です。 無効なサイズを指定すると、システムによって選択された値が使用されます。 このオプションは、「*DPIから保護する*」というステルスモード機能が有効になっている場合にのみ適用されます。

### Plain HTTP request fragment size（プレーンHTTPリクエストフラグメントサイズ）

HTTPリクエストフラグメンテーションのサイズを調整します。 このオプションは、プレーンHTTPトラフィックにのみ影響します。 このオプションを有効にすると、AdGuardは最初のパケットを2つの部分に分割します。最初の部分は指定された長さで、2番目の部分は最初のパケット全体の長さまでの残りの内容です。

有効な値は 1～1500 です。 無効なサイズを指定すると、システムによって選択された値が使用されます。 このオプションは、「*DPIから保護する*」というステルスモード機能が有効になっている場合にのみ適用されます。

### QUICを表示する

フィルタリングログにQUICプロトコルレコードの表示を許可します。 ブロックされたリクエストのみ対象。

### TCP keepalive を有効にする

コネクションがアクティブであることを確認するためとNATタイムアウトを更新するために、アイドル状態のコネクションに定期的にTCPパケットを送信します。 このオプションは、一部のISPが使用する厳格なネットワークアドレス変換（NAT）設定をバイパスするのに便利です。

### TCP keepalive interval

ここで、キープアライブ（keepalive）プローブを送信する前のアイドル時間を秒単位で指定できます。 「0」を指定すると、システムによって選択された値が使用されます。

:::note

※この設定は、「*TCP keepalive を有効にする*」オプションが有効になっている場合にのみ機能すします。

:::

### TCP keepalive timeout

応答がないpeerに再度keepaliveプローブを送信するまでの時間 (秒単位)を指定できます。 「0」を指定すると、システムによって選択された値が使用されます。

:::note

※この設定は、「*TCP keepalive を有効にする*」オプションが有効になっている場合にのみ機能すします。

:::

### Javaをブロックする

一部のウェブサイトやウェブサービスは、現在もJavaプラグインをサポートしています。 Javaプラグインの基礎となるAPIには、深刻なセキュリティ上の脆弱性があります。 セキュリティのため、このようなプラグインを無効にすることができます。 ※「*Javaをブロックする*」オプションを使っても、JavaScriptは有効のままです。

### DNSサーバーのタイムアウト期間

ここで、AdGuardがフォールバックに頼る前に、選択したDNSサーバーからの応答を待つ時間をミリ秒単位で指定できます。 このフィールドに何も入力しないか、無効な値を入力すると、5000という値が使用されます。

### DNS-over-HTTPS に HTTP/3 を使用する

選択したアップストリームがこのプロトコルをサポートしている場合、接続を高速化するためにDNS-over-HTTPSアップストリームでHTTP/3を有効にします。 つまり、このオプションを有効にしても、すべてのDNSリクエストがHTTP/3経由で送信されることが保証されるわけではありません。

### フォールバックDNSアップストリームを使用する

指定のアップストリームへのDNSリクエストがすべて失敗した場合、通常のクエリはフォールバックアップストリームにリダイレクトされます。

### DNSアップストリームを並列に問い合わせる

すべてのアップストリームに並行して問い合わせが行われます。最初の応答が返されます。 DNSクエリは並行して行われるため、この機能を有効にするとインターネット速度が向上します。

### 失敗したDNSクエリにいつも応答する

転送(forward)された各アップストリームおよびフォールバックドメインで アドレス解決が失敗した場合、DNSリクエストに対する応答は`SERVFAIL`となります。

### セキュアなDNSリクエストのフィルタリングを有効にする

AdGuardは、プレーンDNSリクエストに加え、セキュアDNSリクエストもローカルDNSプロキシにリダイレクトします。

### hostsルール用ブロックモード

ここでは、[hosts ルールの構文に基づいて](https://adguard-dns.io/kb/general/dns-filtering-syntax/#etc-hosts-syntax)、AdGuard が DNS ルールでブロックされたドメインに応答する方法を選択できます。

- 「拒否されました」（Refused）エラーで返答する
- 「NxDomain」エラーで返答する
- カスタムIPアドレスで返答する

### adblock-styleルール用ブロックモード

ここでは、[adblock-styleの構文に基づいて](https://adguard-dns.io/kb/general/dns-filtering-syntax/#adblock-style-syntax)、AdGuard が DNS ルールでブロックされたドメインに応答する方法を選択できます。

- 「拒否されました」（Refused）エラーで返答する
- 「NxDomain」エラーで返答する
- カスタムIPアドレスで返答する

### カスタムIPv4アドレス

「adblock-styleルール用ブロックモード」や「hostsルール用ブロックモード」で「カスタムIPアドレス」オプションが選択されている場合、ブロックされた「A」リクエストに対して以下のIPアドレスが返されます。 何も指定しない場合、AdGuardはデフォルトのRefusedエラーで返信します。

### カスタムIPv6アドレス

「adblock-styleルール用ブロックモード」や「hostsルール用ブロックモード」で「カスタムIPアドレス」オプションが選択されている場合、ブロックされた「AAAA」リクエストに対して以下のIPアドレスが返されます。 何も指定しない場合、AdGuardはデフォルトの「Refused」エラーで返信します。

### フォールバックサーバー

ここでは、メインサーバーが次のセクションで指定されたタイムアウト期間内に応答しなかった場合に、DNSリクエストを再ルーティングする代替DNSサーバーを指定することができます。 選択できるオプションは 3 つあります:

- フォールバックサーバーを使用しない
- システムデフォルトサーバーを使用する
- カスタムサーバーを使用する

### ECHをブロックする

この設定を有効にすると、AdGuardは応答からECH（Encrypted Client Hello）パラメータを削除します。

### カスタムフォールバックサーバーのリスト

AdGuardにカスタムフォールバックサーバーを使用させたい場合は、このセクションに1行に1つずつサーバーを列挙してください。

### カスタムbootstrapアドレスのリスト

bootstrap（ブートストラップ）とは、「*DNS通信を保護*」で選択しているセキュアDNSサーバーのIPアドレスを取得するために使用される中間DNSサーバーのことです。 このような「中間点」は、サーバー アドレスを文字で示すプロトコル (DNS-over-TLS など) を使用する場合に必要です。 この場合、ブートストラップは翻訳機として機能し、文字をシステムが理解できる数字に変換してくれます。

デフォルトでは、システムDNSリゾルバが使用され、最初のブートストラップ要求はポート53を通して行われます。 これ以外が必要な場合、ここで、暗号化されたDNSサーバーのアドレスを決定するために使用されるDNSサーバーのIPアドレスを（上から下に）入力することができます。 指定されたIPアドレスは、リストされた順番で適用されます。 無効なアドレスを指定した場合、またはアドレスをまったく指定しなかった場合は、システムIPが使用されます。

### DNS除外リスト

ここリストされているドメインへのすべてのDNSリクエストは、アプリの設定で指定されたDNSサーバーではなく、システムデフォルトDNSサーバーにリダイレクトされます。 また、このようなリクエストにDNSブロックルールは適用されません。

### 指定したWi-Fiネットワーク名（SSID）をDNSフィルタリングの対象から外す

ここで入力されたWi-Fiネットワークに対し「DNS通信を保護」はオフになります。 Wi-Fiネットワーク名（SSID）を1行に1つずつ指定します。 これは、特定のWi-Fiネットワークがすでに AdGuard Home または他のDNS保護システムによって保護されている場合に便利です。 このような場合に、DNSリクエストの重複フィルタリングを避けることができます。
