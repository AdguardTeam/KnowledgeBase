---
title: Гид по Низкоуровневым настройкам
sidebar_position: 6
---

:::info

This article is about AdGuard for Android, a multifunctional ad blocker that protects your device at the system level. Чтобы увидеть, как он работает, [скачайте приложение AdGuard](https://agrd.io/download-kb-adblock)

:::

## Как получить доступ к Низкоуровневым настройкам

:::caution

Изменение *Низкоуровневых настроек* может вызвать проблемы с производительностью AdGuard, нарушить подключение к интернету или поставить под угрозу вашу безопасность и конфиденциальность. This section should only be opened if you know what you are doing, or you were asked to do so by our support team.

:::

Чтобы перейти к *Низкоуровневым настройкам*, откройте приложение AdGuard и коснитесь значка шестерёнки в правом нижнем углу экрана. Затем выберите *Общие → Дополнительные → Низкоуровневые настройки*.

## Низкоуровневые настройки

В AdGuard 4.0 для Android мы полностью переработали низкоуровневые настройки: разделили их на тематические блоки, сделали более понятными, добавили проверку введённых значений и другие меры предосторожности, избавились от одних настроек и добавили другие.

### DNS-защита

#### Резервные серверы

Здесь вы можете указать резервный DNS-резолвер, который будет использоваться, если настроенный сервер недоступен. Существует три варианта: *Автоматический DNS*, *Отсутствует* и *Пользовательский DNS*. Если резервный сервер не указан, то будет использоваться *Aвтоматический DNS* — системный DNS-сервер или AdGuard DNS. *Отсутствует* означает отсутствие запасного варианта. Выбирая *Пользовательский DNS*, вы можете использовать IPv4- и IPv6-адреса в качестве upstream-серверов.

#### Резервные домены

Здесь вы можете перечислить домены, которые будут перенаправлены напрямую на резервные апстримы, если они существуют.

#### Обнаруживать search-домены

Если эта настройка включена, AdGuard будет определять поисковые домены и автоматически перенаправлять их на резервные upstream-серверы.

#### Bootstrap DNS-серверы

Загрузочный DNS для серверов DoH, DoT и DoQ. The *Automatic DNS* — the system DNS or AdGuard DNS — is used by default. Выбирая *Пользовательский DNS*, вы можете использовать IPv4- и IPv6-адреса в качестве upstream-серверов.

#### Режим блокировки для правил adblock

Здесь можно указать тип ответа для доменов, блокируемых правилами DNS на основе синтаксиса правил adblock (например, `||example.org^`).

- Отвечать кодом REFUSED
- Отвечать кодом NXDOMAIN
- Отвечать пользовательским IP-адресом (здесь можно указать адреса IPv4 и IPv6)

#### Режим блокировки для правил hosts

Здесь можно указать тип ответа для доменов, блокируемых правилами DNS на основе синтаксиса правил hosts (например, `<ip> <domain> 0.0.0.0 example.com`).

- Отвечать кодом REFUSED
- Отвечать кодом NXDOMAIN
- Отвечать пользовательским IP-адресом (здесь можно указать адреса IPv4 и IPv6)

#### Время ожидания DNS-запроса

В этом поле вы можете указать время в миллисекундах, в течение которого AdGuard будет ждать ответа от выбранного DNS-сервера, прежде чем прибегнуть к резервному. Если вы не заполните это поле или введёте недопустимое значение, будет использовано значение 5000.

#### Заблокированный ответ TTL

Здесь вы можете указать значение TTL (время жизни пакета данных в протоколе IP), которое будет возвращено в ответ на заблокированный запрос.

#### Размер кеша DNS

Здесь вы можете указать максимальное количество кешируемых ответов. Значение по умолчанию — 1000.

#### Блокировка ECH

Если опция включена, AdGuard удаляет из DNS-ответов параметры Encrypted Client Hello.

#### Игнорировать недоступный исходящий прокси-сервер

Если эта настройка включена, AdGuard будет отправлять DNS-запросы напрямую, когда исходящий прокси недоступен.

#### Пробовать HTTP/3 для upstream-серверов DNS-over-HTTPS

Если эта опция включена, AdGuard использует HTTP/3 для ускорения разрешения DNS-запросов для upstream-серверов DoH. В противном случае AdGuard вернётся к поведению по умолчанию и будет использовать HTTP/2 для отправки всех DNS-запросов для DNS-over-HTTPS.

#### Отвечать на ошибку кодом SERVFAIL

Если эта настройка включена и все upstream-серверы, включая резервные, не отвечают, AdGuard отправит клиенту ответ SERVFAIL.

#### Использовать резервный сервер для нерезервных доменов

Если эта настройка включена, AdGuard будет использовать резервные upstream-серверы для всех доменов. В противном случае резервный upstream-сервер будет использоваться только для резервных и поисковых доменов, если соответствующий параметр включён.

#### Проверять upstream-серверы DNS

Если этот параметр включён, AdGuard будет проверять upstrem-серверы DNS перед добавлением или обновлением пользовательских DNS-серверов.

#### Filter secure DNS

If this setting is on, AdGuard will apply all enabled DNS filters and DNS user rules to encrypted DNS-over-HTTPS (DoH) traffic and not only to plain DNS. DoH traffic mostly comes from Chrome and other browsers that have a *Secure DNS* (or similar) setting. You can use *Filter secure DNS* in two different modes:

- **Filter on the fly**. In this mode, AdGuard applies all enabled DNS filters and DNS user rules to DoH traffic but doesn’t redirect it to the local DNS proxy. If a DNS server is specified in the browser’s settings, this server will handle the DoH traffic for this browser

- **Redirect to DNS proxy**. In this mode, AdGuard applies all enabled DNS filters and DNS user rules to DoH traffic by redirecting it to the local DNS proxy. The DNS server specified in the AdGuard’s DNS settings will handle all DoH traffic

### Фильтрация

#### Записывать HAR

Если эта настройка включена, AdGuard будет перехватывать HAR-файлы. It will create a directory named “har” inside the app cache directory and add there information about all filtered HTTP requests in HAR 1.2 format that can be analyzed with the Fiddler program.

Используйте его только для целей отладки!

### HTTPS-фильтрация

#### Encrypted Client Hello

У каждого зашифрованного интернет-соединения есть незашифрованная часть. Это самый первый пакет, который содержит имя сервера, к которому вы подключаетесь. Технология Encrypted Client Hello должна решить эту проблему и зашифровать последний бит незашифрованной информации. Чтобы воспользоваться ей, включите опцию *Использовать Encrypted Client Hello*. Она использует локальный DNS-прокси для поиска ECH-конфигурации для домена. Если она найдена, пакет ClientHello будет зашифрован.

#### Проверка OCSP

Если эта настройка включена, AdGuard будет выполнять асинхронные проверки OCSP для получения информации о статусе отзыва SSL-сертификата сайта.

Если проверка OCSP завершается в течение указанного тайм-аута, AdGuard немедленно заблокирует соединение, если сертификат отозван, или установит соединение, если сертификат действителен.

Если проверка занимает слишком много времени, AdGuard разрешит подключение, продолжая проверять состояние сертификата в фоновом режиме. Если сертификат отозван, текущие и будущие подключения к домену будут заблокированы.

#### Перенаправлять запросы DNS-over-HTTPS

Если опция включена, AdGuard перенаправляет запросы DNS-over-HTTPS на локальный DNS-прокси в дополнение к обычным DNS-запросам. Для сохранения конфиденциальности мы рекомендуем отключить резервные upstream-серверы и использовать только зашифрованные DNS-серверы.

#### Фильтровать HTTP/3

Если этот параметр включён, AdGuard будет фильтровать запросы, отправленные по протоколу HTTP/3, в дополнение к другим типам запросов.

### Исходящий прокси

#### Показывать настройку «Фильтровать DNS-запросы»

Если эта настройка включена, переключатель *Фильтровать DNS-запросы* будет отображаться в диалоговом окне *Добавить прокси-сервер*. Используйте его для включения фильтрации DNS-запросов, проходящих через указанный прокси.

### Защита

#### Диапазоны портов

Здесь вы можете указать диапазоны портов, которые должны быть отфильтрованы.

#### Фиксировать удаление HTML-элементов

Если этот параметр включён, AdGuard будет записывать заблокированные HTML-элементы в *Недавнюю активность*.

#### Отладка скриптлетов

При включении этого параметра активируется отладка в скриптлетах, а в логах браузера фиксируется применение правил скриптлетов.

#### Исключённые приложения

Здесь вы можете перечислить имена пакетов и UID, которые вы хотите исключить из защиты AdGuard.

#### Пакеты для обхода QUIC

Здесь вы можете указать имена пакетов, для которых AdGuard должен обходить трафик QUIC.

#### Перенастраивать Автоматический прокси при изменении сети

Если этот параметр включён, то при подключении устройства к другой сети защита AdGuard будет перезапускаться для перенастройки параметров автоматического прокси. Эта настройка применяется только в том случае, если для параметра *Режим маршрутизации* установлено значение *Автоматический прокси*.

#### Фильтрация IPv6

Если эта настройка включена, AdGuard фильтрует сети IPv6, если доступен сетевой интерфейс IPv6.

#### Диапазоны IPv4-адресов, исключённые из фильтрации

Фильтрация для диапазонов IPv4, перечисленных в данном разделе, отключена.

#### Диапазоны IPv6-адресов, исключённые из фильтрации

Фильтрация для диапазонов IPv6, перечисленных в данном разделе, отключена.

#### TCP keepalive для исходящих сокетов

Если эта опция включена, AdGuard отправляет проверку активности через указанный период времени, чтобы убедиться, что TCP-соединение активно. Здесь вы можете указать время простоя перед запуском проверок активности и время между проверками активности для неотвечающего узла.

После заданного системой количества неудачных попыток получить ответ от сервера система автоматически закрывает TCP-соединение.

### Настройки локального VPN

#### Время ожидания для остановленного VPN

Здесь вы можете установить время задержки в миллисекундах, прежде чем AdGuard попытается восстановить VPN-защиту после её отзыва сторонним VPN-приложением или удалением VPN-профиля. Значение по умолчанию — 5000 мс.

#### Задержка для восстановления отключённого VPN

Здесь вы можете установить время задержки в миллисекундах, прежде чем AdGuard перенесёт восстановление VPN-защиты после того, как она была отозвана сторонним VPN-приложением или путём удаления VPN-профиля. Значение по умолчанию — 5000 мс.

#### MTU

Здесь вы можете установить максимальное значение передачи данных MTU через VPN. Рекомендуемый диапазон: 1500–1900 байт.

#### Автоматически возобновлять работу VPN

Если этот параметр включён, то локальный VPN AdGuard будет автоматически включаться после выключения из-за отсутствия сети, привязки к сети или режима низкого энергопотребления.

#### Захват пакетов (PCAP)

Если эта настройка включена, AdGuard будет создавать файл `timestamp.pcap` (например, 1682599851461.pcap) в каталоге кэша приложений. В этом файле будут перечислены все сетевые пакеты, передаваемые через VPN. Их можно проанализировать с помощью программы Wireshark.

#### Включить шлюз Wi-Fi в маршруты VPN

If this setting is enabled, the gateway IP addresses will be added to VPN routes when on Wi-Fi.

#### IPv4-адрес

Здесь вы можете ввести IP-адрес, который будет использоваться для создания интерфейса TUN. По умолчанию это `172.18.11.218`.

#### Принудительно маршрутизировать LAN IPv4

Если эта опция включена, AdGuard фильтрует все LAN-соединения, включая трафик локальной сети IPv4, даже если включена опция *Маршрутизировать все IPv4-подключения в локальной сети*.

#### Маршрутизировать все IPv4-подключения в локальной сети

Если эта настройка включена, AdGuard исключит из фильтрации LAN-соединения для простых сетей. Для сложных сетей это может не подойти. Этот параметр применяется только в том случае, если настройка *Принудительно маршрутизировать LAN IPv4* отключена.

#### IPv6-адрес

Здесь вы можете ввести IP-адрес, который будет использоваться для создания интерфейса TUN. По умолчанию это `2001:db8:ad:0:ff::`.

### Разное

#### Обнаруживать Samsung Pay

Если настройка включена, защита AdGuard будет приостановлена на время использования Samsung Pay. Эта функция необходима корейским пользователям, поскольку при включении AdGuard у них возникают проблемы с [Samsung Pay](/adguard-for-android/solving-problems/samsungpay-with-adguard-in-south-korea).
