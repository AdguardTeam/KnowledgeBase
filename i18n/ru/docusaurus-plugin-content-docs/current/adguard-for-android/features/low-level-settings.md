---
title: Низкоуровневые настройки
sidebar_position: 5
---

:::info

В этой статье рассказывается об AdGuard для Android — многофункциональном блокировщике рекламы, который защищает ваше устройство на системном уровне. [Скачайте приложение AdGuard](https://agrd.io/download-kb-adblock), чтобы увидеть, как оно работает

:::

## Как получить доступ к Низкоуровневым настройкам

:::caution

Изменение <em x-id="3">Низкоуровневых настроек</em> может вызвать проблемы с производительностью AdGuard, нарушить подключение к интернету или поставить под угрозу вашу безопасность и конфиденциальность. Открывайте этот раздел, только если вы знаете, что делаете, или если вас попросила об этом наша команда поддержки.

:::

Чтобы перейти к _Низкоуровневым настройкам_, откройте приложение AdGuard и коснитесь значка шестерёнки в правом нижнем углу экрана. Затем выберите _Основные → Расширенные → Низкоуровневые настройки_.

## Низкоуровневые настройки

Для AdGuard 4.0 для Android мы полностью переработали Низкоуровневые настройки. Мы внесли изменения в список настроек и разбили их на тематические группы с улучшенными описаниями. Мы также добавили проверку ввода и другие защитные механизмы.

### DNS-защита

#### Резервные серверы

Здесь вы можете указать резервный DNS-резолвер, который будет использоваться, если настроенный сервер недоступен. Доступные варианты:

- _Автоматический DNS_: выберите его, если хотите использовать системный DNS или AdGuard DNS.
- _Нет_: выберите этот вариант, если вам не нужен никакой резервный сервер.
- _Пользовательский DNS_: выберите эту опцию и введите IPv4 или IPv6-адреса незашифрованных DNS-серверов, по одному в строке. Эти адреса будут использованы как upstream-серверы.

#### Резервные домены

Здесь можно перечислить домены, которые будут перенаправлены на резервные upstream-серверы, если они доступны. Вы можете ввести несколько доменов, по одному в строке. Использование подстановочных знаков ограничено.

#### Обнаруживать search-домены

Если эта настройка включена, AdGuard будет определять search-домены и автоматически перенаправлять их на резервные upstream-серверы.

#### Bootstrap DNS-серверы

Bootstrap DNS для зашифрованных upstream DNS-серверов, таких как DoH, DoT и DoQ. Доступные варианты:

- _Автоматический DNS_: выберите его, если хотите использовать системный DNS или AdGuard DNS. Этот параметр выбран по умолчанию.
- _Пользовательский DNS_: выберите эту опцию и введите IPv4 или IPv6-адреса незашифрованных DNS-серверов, по одному в строке. Эти адреса будут использованы как bootstrap upstream-серверы.

#### Режим блокировки для правил adblock

Здесь можно указать тип ответа для доменов, блокируемых правилами DNS на основе синтаксиса правил adblock (например, `||example.org^`). Доступные варианты:

- _REFUSED_: отвечать кодом REFUSED
- _NXDOMAIN_: отвечать кодом NXDOMAIN
- _Пользовательский IP-адрес_: выберите этот вариант, чтобы отвечать с пользовательским IP-адресом. Потребуется ввести IPv4-адрес для блокированных A-запросов и IPv6-адрес для блокированных AAAA-запросов.

#### Режим блокировки для правил hosts

Здесь можно указать тип ответа для доменов, блокируемых DNS-правилами на основе синтаксиса hosts-правил
(например, `<ip> <domain> 0.0.0.0 example.com`).

- _REFUSED_: отвечать кодом REFUSED
- _NXDOMAIN_: отвечать кодом NXDOMAIN
- _Пользовательский IP-адрес_: выберите этот вариант, чтобы отвечать с пользовательским IP-адресом. Потребуется ввести IPv4-адрес для блокированных A-запросов и IPv6-адрес для блокированных AAAA-запросов.

#### Время ожидания DNS-запроса

Здесь вы можете указать время ожидания в миллисекундах для каждого DNS-запроса. AdGuard будет выдерживать указанный промежуток времени, прежде чем перенаправить запрос на резервный DNS-резолвер. Если вы не заполните это поле или введёте некорректное значение, будет использовано значение 5000 мс.
Если у вас несколько upstream-серверов, резервный DNS будет использоваться только после окончания времени ожидания для каждого upstream-сервера.

#### TTL заблокированного ответа

Здесь вы можете установить время жизни (TTL) записи для заблокированных доменов. Значение по умолчанию — 3600 секунд.

#### Размер кеша DNS

Здесь вы можете указать максимальное количество кешируемых ответов. Значение по умолчанию — 1000.

#### Блокировка ECH

Если настройка включена, AdGuard блокирует TLS Encrypted Hello (ECH) в DNS-ответах.

#### Пробовать HTTP/3 для upstream-серверов DNS-over-HTTPS

Если включить эту опцию, AdGuard будет использовать HTTP/3 для ускорения разрешения DNS-запросов для upstream-серверов DNS-over-HTTPS. В противном случае AdGuard вернётся к поведению по умолчанию и будет использовать HTTP/2 для отправки всех DNS-запросов для DNS-over-HTTPS.

#### Отвечать на ошибку кодом SERVFAIL

Если эта настройка включена, AdGuard отправляет клиенту ответ SERVFAIL, если все upstream-серверы, включая резервные, не отвечают. Если настройка отключена, ответ клиенту в этом случае не будет отправлен.

#### Использовать резервные серверы для всех доменов

Если эта настройка включена, AdGuard использует резервные upstream-серверы для всех доменов, включая домены без резервных серверов. Когда настройка выключена, резервный upstream-сервер используется только для резервных и поисковых доменов, если соответствующий параметр включён.

#### Проверять upstream-серверы DNS

Если этот параметр включён, AdGuard проверяет upstrem-серверы DNS перед добавлением или обновлением пользовательских DNS-серверов.

#### Фильтровать зашифрованные DNS-запросы

Если эта настройка включена, AdGuard фильтрует зашифрованные DNS-запросы дополнительно к незашифрованным DNS-запросам. Зашифрованный DNS-трафик в основном поступает из Chrome и других браузеров, в которых есть настройка безопасного DNS.

У этой настройки есть два режима:

- **Фильтровать на лету**. В этом режиме AdGuard фильтрует трафик DNS-over-HTTPS без перенаправления на локальный DNS-прокси. Он будет использовать DNS-сервер, указанный в настройках браузера.

- **Перенаправлять на DNS-прокси**. В этом режиме AdGuard будет перенаправлять запросы DNS-over-HTTPS на локальный DNS-прокси для фильтрации. Будет использоваться DNS-сервер, выбранный в настройках DNS приложения AdGuard.

### Фильтрация

#### Записывать HAR

Если эта настройка включена, AdGuard записывает все отфильтрованные HTTP-запросы в формате HAR 1.2 в папку app cache, подпапку "har". Эти файлы можно проанализировать с помощью приложения Fiddler.

Эта настройка может замедлить работу вашего устройства. Используйте её только для отладки.

### HTTPS-фильтрация

#### Encrypted Client Hello

Если включить эту опцию, AdGuard при необходимости будет шифровать ClientHellos. При этом HTTPS-фильтрация должна быть включена. Эта функция использует локальный DNS-прокси для поиска ECH-конфигурации для домена. Если она найдена, пакет ClientHello будет зашифрован. Убедитесь, что вы используете зашифрованный DNS-сервер с этой функцией.

**О ClientHellos и ECH**: У каждого зашифрованного интернет-соединения есть незашифрованная часть. Это самый первый пакет, который содержит имя сервера, к которому вы подключаетесь. Технология Encrypted Client Hello призвана решить эту проблему путём шифрования данного пакета.

#### Проверка OCSP

Если этот параметр включён, AdGuard автоматически проверяет статус отзыва SSL-сертификатов перед подключением к сайту. При этом HTTPS-фильтрация должна быть включена.

Если проверка завершается в течение требуемого тайм-аута, AdGuard разрешает соединение, если сертификат действителен, или немедленно блокирует его, если сертификат отозван.

Если проверка занимает слишком много времени, AdGuard разрешит подключение, продолжая проверять состояние сертификата в фоновом режиме. Если сертификат отозван, текущие и будущие подключения к домену будут заблокированы.

#### Фильтровать HTTP/3

Если этот параметр включён, AdGuard будет фильтровать запросы, отправленные по протоколу HTTP/3, в дополнение к другим типам запросов. При этом HTTPS-фильтрация должна быть включена.

**О протоколе HTTP/3**: это последняя версия протокола HTTP, основанная на QUIC.

### Исходящий прокси

#### Показывать настройку «Фильтровать DNS-запросы»

Если эта настройка включена, в диалоговом окне _Добавить прокси-сервер_ отображается переключатель _Фильтровать DNS-запросы_. Чтобы открыть диалог, зайдите в **Настройки**, затем перейдите в раздел **Фильтрация** → **Сеть** → **Прокси** → **Прокси-сервер** и нажмите _+ Добавить прокси-сервер_. Включение этого переключателя активирует фильтрацию DNS-запросов, проходящих через указанный исходящий прокси-сервер.

### Защита

#### Диапазоны портов

Здесь можно указать диапазоны портов, которые нужно фильтровать. Диапазоны портов следует вводить по одному в каждой строке. Используйте `..`, чтобы указать диапазон. Например, `80..5221`.

#### Фиксировать удаление HTML-элементов

Если этот параметр включён, AdGuard записывает информацию о заблокированных HTML-элементах в раздел _Недавняя активность_. Чтобы открыть логи, перейдите в **Статистику** → **Недавняя активность**.

#### Отладка скриптлетов

Если эта настройка включена, приложение отображает отладочную информацию в консоли браузера. В этом режиме активируется отладка скриптлетов, и браузер регистрирует события, происходящие при применении правил скриптлетов.

#### Исключённые приложения

Здесь можно перечислить пакеты и UID, которые следует исключить из защиты AdGuard. Введите имена пакетов или UID по одному в строке. Используйте `//` для комментариев.

#### Приложения без фильтрации QUIC

Здесь вы можете указать имена пакетов, для которых AdGuard должен обходить QUIC-трафик. Введите имена приложений по одному в строке. Используйте `//` для комментариев.

#### Перенастраивать Автоматический прокси при изменении сети

Если параметр включён, защита AdGuard перезапустится, чтобы перенастроить параметры автоматического прокси-сервера при подключении вашего устройства к другой сети. Эта настройка применяется только тогда, когда _Режим маршрутизации_ установлен на _Автоматический прокси_.

#### Фильтрация IPv6

Если эта настройка включена, AdGuard фильтрует сети IPv6, если доступен сетевой интерфейс IPv6.

#### Диапазоны IPv4-адресов, исключённые из фильтрации

Здесь вы можете перечислить диапазоны IPv4-адресов, которые следует исключить из фильтрации. Введите по одному диапазону IP на строку. Используйте `//` для комментариев.

#### Диапазоны IPv6-адресов, исключённые из фильтрации

Здесь вы можете перечислить диапазоны IPv6, которые следует исключить из фильтрации. Введите по одному диапазону IP на строку. Используйте `//` для комментариев.

#### TCP keepalive для исходящих сокетов

Если эта опция включена, AdGuard отправляет тестовый сигнал через указанный период времени, чтобы убедиться, что TCP-соединение всё ещё активно. После заданного системой количества неудачных попыток получить ответ от сервера система автоматически закроет TCP-соединение.

Это настройка позволяет указать:

- **Время ожидания** в секундах перед отправкой запросов проверки активности TCP на исходящие сокеты. Значение по умолчанию — 0. Если у вас возникают проблемы с NAT, установите значение 20.
- **Время между проверками активности** для неотзывающегося узла. Значение по умолчанию — 0 секунд.

### Настройки локального VPN

#### Время ожидания для остановленного VPN

Здесь вы можете установить время задержки в миллисекундах, прежде чем AdGuard попытается восстановить VPN-защиту после того, как она была отозвана сторонним VPN-приложением или путём удаления VPN-профиля. Значение по умолчанию — 5000 мс.

#### Задержка для восстановления отключённого VPN

Здесь вы можете установить время задержки в миллисекундах, прежде чем AdGuard перенесёт восстановление VPN-защиты после того, как она была отозвана сторонним VPN-приложением или путём удаления VPN-профиля. Значение по умолчанию — 5000 мс.

#### MTU

Здесь вы можете установить максимальный размер передаваемого блока данных (MTU) для VPN-интерфейса. Это максимальный размер пакета данных для вашей локальной сети VPN. Рекомендуемый диапазон: 1500–1900 байт.

#### Захват пакетов (PCAP)

Эта настройка включает логирование TUN-интерфейсов. Когда эта функция включена, AdGuard создаёт файл `timestamp.pcap`, например 1682599851461.pcap, в папке cache  приложения. В этом файле перечислены все сетевые пакеты, передаваемые через VPN, которые можно проанализировать с помощью программы Wireshark.

#### Включить шлюз Wi-Fi в маршруты VPN

Если этот параметр включён, IP-адреса шлюзов будут добавляться в VPN-маршруты, когда устройство подключено к Wi-Fi.

#### IPv4-адрес

Здесь вы можете указать IP-адрес, который будет использоваться для создания TUN-интерфейса. Значение по умолчанию — `172.18.11.218`.

#### Принудительно маршрутизировать LAN IPv4

Если эта опция включена, AdGuard фильтрует все LAN-соединения, включая трафик локальной сети IPv4, даже если включена опция _Маршрутизировать все IPv4-подключения в локальной сети_.

#### Маршрутизировать все IPv4-подключения в локальной сети

Если эта настройка включена, AdGuard исключит из фильтрации LAN-соединения для простых сетей. Для сложных сетей это может не подойти. Этот параметр применяется только в том случае, если настройка _Принудительно маршрутизировать LAN IPv4_ отключена.

#### IPv6-адрес

Здесь вы можете ввести IP-адрес, который будет использоваться для создания интерфейса TUN. Значение по умолчанию — `2001:db8:ad:0:ff::`.

### Разное

#### Показывать инструменты разработчика на главном экране

Если эта настройка включена, AdGuard отображает иконку **Инструменты разработчика** в верхнем правом углу главного экрана приложения.

**Инструменты разработчика** — специализированный раздел, доступный в AdGuard 4.3 для Android и более поздних версий, предназначенный для быстрой навигации и переключения между функциями. Он позволяет быстро включать и отключать пользовательские фильтры, получать доступ к логам, включать различные варианты логирования и многое другое.

#### Обнаруживать Samsung Pay

Если эта настройка включена, защита AdGuard будет приостановлена, когда вы откроете приложение Samsung Pay. Эта функция нужна пользователям из Кореи, поскольку у них возникают [проблемы с Samsung Pay](/adguard-for-android/solving-problems/samsungpay-with-adguard-in-south-korea) при включённом AdGuard.
