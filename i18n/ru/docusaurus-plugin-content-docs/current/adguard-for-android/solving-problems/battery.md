---
title: Проблемы с батареей и потреблением трафика
sidebar_position: 1
---

Иногда вы можете заметить, что, согласно встроенной статистике Android, AdGuard расходует большое количество трафика и/или ресурса батареи.

Эти проблемы — две стороны одной медали. Так как в процессе фильтрации весь мобильный трафик проходит через AdGuard, Android считает, что именно AdGuard потребляет его весь. В реальности это, конечно, не так.

Расход батареи и трафика, показываемый в статистике устройства, **не соответствует действительности**. Дело в том, что Android приписывает AdGuard весь мобильный и Wi-Fi трафик, который был на самом деле потреблён другими приложениями. Из-за этого доля AdGuard значительно повышается, а доля остальных приложений, наоборот, снижается.

### Собственная статистика расхода батареи

Чтобы устранить это недоразумение, мы добавили новый раздел «Расход батареи». Вы можете получить доступ к нему, нажав на значок батареи в правом верхнем углу главного экрана.

![Статистика батареи](https://cdn.adguard.com/content/kb/ad_blocker/android/solving_problems/battery/batterystats.png)

Внутри вы найдёте график, показывающий реальное потребление ресурса батареи AdGuard запоследние 24 часа, с возможностью получить более детальную информацию о почасовом расходе, нажав на точки на графике. Кроме того, там также есть числовая разбивка релевантных данных и краткое техническое пояснение.

### Реальный пример

На скриншотах ниже показана статистика потребления батареи за ночь и утро:

![Батарея 1](https://cdn.adguard.com/public/Adguard/kb/PicturesEN/battery_1.png) ![Батарея 2](https://cdn.adguard.com/public/Adguard/kb/PicturesEN/battery_2.png) ![Батарея 3](https://cdn.adguard.com/public/Adguard/kb/PicturesEN/battery_3.png)

Из этих скриншотов видно, что:

1. AdGuard, как и ожидалось, находится в верхней части графика. Это вообще характерно для телефонов (и совсем не характерно для планшетов без 4G, потому что Wi-Fi с точки зрения расхода батареи потребляет намного меньше).

2. Обратите внимание на количество отправленных пакетов Mobile и Wi-Fi, которые засчитались приложению AdGuard («мобильных пакетов отправлено» и «пакетов Wi-Fi отправлено») на скриншоте №2.

3. На скриншоте №3 статистика одного из реальных потребителей трафика, Яндекс.Браузера. На его счёт вообще трафика почти не засчиталось, хотя на деле 70% трафика израсходовано именно им.

### Сколько заряда батареи на самом деле потребляет AdGuard?

Для начала приведём немного теории и ссылок с необходимыми данными.

1. Android считает потребление трафика исходя из так называемого Power Profile, который предоставляется каждым производителем: <https://source.android.com/devices/tech/power/values.html>

2. Главная часть Power Profile — это набор значений, выраженных в миллиамперах, которые определяют потребление батареи каждым компонентом устройства: <https://source.android.com/devices/tech/power/values.html>

Например, из таблицы выше:

_wifi.active=_ 31mA дополнительное потребление в миллиамперах, вызванное передачей данных по Wi-Fi.

_radio.active=_ 100-300mA дополнительное потребление в миллиамперах, вызванное передачей данных по мобильной сети.

_cpu.active=_ 100-200mA дополнительное потребление в миллиамперах, вызванное работой процессора.

3. AdGuard самостоятельно почти не потребляет трафика, так что для оценки потребления батареи отбросим значения Mobile/Wi-Fi packets и остановимся на подсчёте CPU.

Формула для вычисления потребления:
> "CPU TIME (ms)" X "cpu.active" / (60 * 60 * 1000) = "POWER USE mAh"

Подставим в эту формулу реальные значения.

Возьмём _CPU total_ из второго скриншота и переведём в миллисекунды: 506000

Коэффициент _cpu.active_ для 2GHz будет равен примерно 225mA

Финальный результат
> 506000 * 225 / (60 * 60 * 1000) = 31,625mAh

### Итог

Реальное потребление в **разы ниже** показанного в статистике Android. Вместо 220 мАч оно должно быть в районе 31—40 мАч. С другой стороны, потребление браузера должно быть не 66 мАч, а около 200 мАч.